<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project activeEnvironment="Default" name="PaymentInformationsService" resourceRoot="" soapui-version="4.6.4" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="PaymentInformationsServicePortBinding" type="wsdl" bindingName="{http://service.ws.ingesup.fr/}PaymentInformationsServicePortBinding" soapVersion="1_1" anonymous="optional" definition="file:/Users/Aurore/Documents/workspace/TddMonkey/PaymentInformationsService/PaymentInformationsServiceService.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart="file:/Users/Aurore/Documents/workspace/TddMonkey/PaymentInformationsService/PaymentInformationsServiceService.wsdl"><con:part><con:url>file:/Users/Aurore/Documents/workspace/TddMonkey/PaymentInformationsService/PaymentInformationsServiceService.wsdl</con:url><con:content><![CDATA[<!--Generated by JAX-WS RI at http://jax-ws.dev.java.net. RI's version is JAX-WS RI 2.1.3-b02-.-->
<definitions targetNamespace="http://service.ws.ingesup.fr/" name="PaymentInformationsServiceService" xmlns="http://schemas.xmlsoap.org/wsdl/" xmlns:tns="http://service.ws.ingesup.fr/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/">
  <types>
    <xsd:schema>
      <xsd:import namespace="http://service.ws.ingesup.fr/" schemaLocation="PaymentInformationsServiceService_schema1.xsd"/>
    </xsd:schema>
  </types>
  <message name="Authentification">
    <part name="parameters" element="tns:Authentification"/>
  </message>
  <message name="AuthentificationResponse">
    <part name="parameters" element="tns:AuthentificationResponse"/>
  </message>
  <message name="PaymentInformations">
    <part name="parameters" element="tns:PaymentInformations"/>
  </message>
  <message name="PaymentInformationsResponse">
    <part name="parameters" element="tns:PaymentInformationsResponse"/>
  </message>
  <message name="UserIdInvalidException">
    <part name="fault" element="tns:userIdInvalidFault"/>
  </message>
  <portType name="PaymentInformationsService">
    <operation name="Authentification">
      <input message="tns:Authentification"/>
      <output message="tns:AuthentificationResponse"/>
    </operation>
    <operation name="PaymentInformations">
      <input message="tns:PaymentInformations"/>
      <output message="tns:PaymentInformationsResponse"/>
      <fault message="tns:UserIdInvalidException" name="UserIdInvalidException"/>
    </operation>
  </portType>
  <binding name="PaymentInformationsServicePortBinding" type="tns:PaymentInformationsService">
    <soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/>
    <operation name="Authentification">
      <soap:operation soapAction=""/>
      <input>
        <soap:body use="literal"/>
      </input>
      <output>
        <soap:body use="literal"/>
      </output>
    </operation>
    <operation name="PaymentInformations">
      <soap:operation soapAction=""/>
      <input>
        <soap:body use="literal"/>
      </input>
      <output>
        <soap:body use="literal"/>
      </output>
      <fault name="UserIdInvalidException">
        <soap:fault name="UserIdInvalidException" use="literal"/>
      </fault>
    </operation>
  </binding>
  <service name="PaymentInformationsServiceService">
    <port name="PaymentInformationsServicePort" binding="tns:PaymentInformationsServicePortBinding">
      <soap:address location="REPLACE_WITH_ACTUAL_URL"/>
    </port>
  </service>
</definitions>]]></con:content><con:type>http://schemas.xmlsoap.org/wsdl/</con:type></con:part><con:part><con:url>file:/Users/Aurore/Documents/workspace/TddMonkey/PaymentInformationsService/PaymentInformationsServiceService_schema1.xsd</con:url><con:content><![CDATA[<xs:schema version="1.0" targetNamespace="http://service.ws.ingesup.fr/" xmlns:tns="http://service.ws.ingesup.fr/" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="Authentification" type="tns:Authentification"/>
  <xs:element name="AuthentificationResponse" type="tns:AuthentificationResponse"/>
  <xs:element name="PaymentInformations" type="tns:PaymentInformations"/>
  <xs:element name="PaymentInformationsResponse" type="tns:PaymentInformationsResponse"/>
  <xs:element name="userIdInvalidFault" type="tns:UserIdInvalidException"/>
  <xs:complexType name="PaymentInformations">
    <xs:sequence>
      <xs:element name="userId" type="xs:int"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="PaymentInformationsResponse">
    <xs:sequence>
      <xs:element name="return" type="tns:PaymentInformation" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="PaymentInformation">
    <xs:sequence>
      <xs:element name="date" type="xs:dateTime" minOccurs="0"/>
      <xs:element name="description" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="UserIdInvalidException">
    <xs:sequence>
      <xs:element name="message" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="Authentification">
    <xs:sequence>
      <xs:element name="loginRequest" type="tns:LoginRequest" minOccurs="1"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="LoginRequest">
    <xs:sequence>
      <xs:element name="mail" type="xs:string" minOccurs="1"/>
      <xs:element name="password" type="xs:string" minOccurs="1"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="AuthentificationResponse">
    <xs:sequence>
      <xs:element name="return" type="tns:LoginResponse" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="LoginResponse">
    <xs:sequence>
      <xs:element name="result" type="xs:string" minOccurs="0"/>
      <xs:element name="userId" type="xs:int"/>
    </xs:sequence>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part></con:definitionCache><con:endpoints><con:endpoint>http://localhost:8080/PaymentInformationsService/paymentInformationsService</con:endpoint><con:endpoint>http://localhot:8081/mockService/PaymentInformationsService</con:endpoint></con:endpoints><con:operation isOneWay="false" action="" name="Authentification" bindingOperationName="Authentification" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call name="Request 1"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/PaymentInformationsService/paymentInformationsService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:Authentification>
         <loginRequest>
            <mail>contact@lizhe.me</mail>
            <password>password</password>
         </loginRequest>
      </ser:Authentification>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/AuthentificationRequest"/><con:wsrmConfig version="1.2"/></con:call><con:call name="mockRequest1"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8081/mockService/PaymentInformationsService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:Authentification>
         <loginRequest>
            <mail>?</mail>
            <password>?</password>
         </loginRequest>
      </ser:Authentification>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/AuthentificationRequest"/><con:wsrmConfig version="1.2"/></con:call></con:operation><con:operation isOneWay="false" action="" name="PaymentInformations" bindingOperationName="PaymentInformations" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call name="Request 1"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/PaymentInformationsService/paymentInformationsService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:PaymentInformations>
         <userId></userId>
      </ser:PaymentInformations>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/PaymentInformationsRequest"/><con:wsrmConfig version="1.2"/></con:call></con:operation></con:interface><con:testSuite name="TestSuite 1"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 1" searchProperties="true" id="6c14b2e2-cd19-4609-8c61-930647d5019e"><con:settings/><con:testStep type="properties" name="tempProps" id="53a6347b-e82c-4ec3-ac61-ec5656d5a874"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>userId</con:name><con:value>25</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="request" name="Authentification" id="91043ce7-8ea5-4180-bd35-8982b742e29f"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>PaymentInformationsServicePortBinding</con:interface><con:operation>Authentification</con:operation><con:request name="Authentification" outgoingWss="" incomingWss="" timeout="" sslKeystore="" useWsAddressing="false" useWsReliableMessaging="false" wssPasswordType=""><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/PaymentInformationsService/paymentInformationsService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:Authentification>
         <loginRequest>
            <mail>contact@lizhe.me</mail>
            <password>password</password>
         </loginRequest>
      </ser:Authentification>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" name="SOAP Response"/><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/AuthentificationRequest"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Groovy Script" id="e3c9e187-c6ee-4d56-9533-ca12aeee229e"><con:settings/><con:config><script>// create a groovyUtils instance for XML handling
def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context);
 
// retrieve the JDBC step
def stepAuthent = testRunner.testCase.testSteps["Authentification"];
 
// retrieve the temp properties step
def tempProps = testRunner.testCase.testSteps["tempProps"];
 
// get the  results as XML
def xmlResult = stepAuthent.testRequest.response.getContentAsXml();
//log.info xmlResult
// get a holder object to deal with XPATH
def responseHolder = groovyUtils.getXmlHolder(xmlResult);
 
// 
def userId = responseHolder.getNodeValues("//return/userId/text()");
userId = userId.toString().replaceAll('\\[','');
userId=userId.toString().replaceAll('\\]','');
log.info userId.toString() + " found";

tempProps.setPropertyValue("userId", userId.toString());
// ----------------------
 
// retrieve the SOAP step : createOrder
//def getPaymentInformationsStep = testRunner.testCase.testSteps["getPaymentInformations"];
//testRunner.runTestStep(getPaymentInformationsStep);

//def xmlRespCreate = getPaymentInformationsStep.testRequest.response.getContentAsXml();
//def createHolder = groovyUtils.getXmlHolder(xmlRespCreate);

//def OrderCode = createHolder.getNodeValue("//return/description");

//log.info  xmlRespCreate;


</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" id="57d6a4d8-f96d-4576-818c-249817fa8a4c"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="true" entitize="false" transferChildNodes="true"><con:name>userId</con:name><con:sourceType>userId</con:sourceType><con:sourceStep>tempProps</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>getPaymentInformations</con:targetStep><con:targetPath>//userId</con:targetPath></con:transfers></con:config></con:testStep><con:testStep type="request" name="getPaymentInformations" id="b980a569-206a-42b9-8d55-801a21d57e1d"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>PaymentInformationsServicePortBinding</con:interface><con:operation>PaymentInformations</con:operation><con:request name="getPaymentInformations"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/PaymentInformationsService/paymentInformationsService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:PaymentInformations>
         <userId>25</userId>
      </ser:PaymentInformations>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:loadTest name="LoadTest 1"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>5</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:assertion type="Step Maximum" name="Step Maximum"><con:configuration><name>Step Maximum</name><min-requests>100</min-requests><max-value>1000</max-value><test-step>Authentification</test-step><max-errors>-1</max-errors></con:configuration></con:assertion><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/><con:securityTest name="SecurityTest 1" failOnError="true"><con:settings/><con:properties/></con:securityTest><con:securityTest name="SecurityTest 2" failOnError="true"><con:settings/><con:properties/></con:securityTest></con:testCase><con:properties/></con:testSuite><con:mockService port="8081" path="/mockService/PaymentInformationsService" host="localhost" name="MockService 1" bindToHostOnly="false" docroot=""><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockService@require-soap-action">false</con:setting></con:settings><con:mockOperation name="Authentification" interface="PaymentInformationsServicePortBinding" operation="Authentification"><con:settings/><con:dispatchPath/><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:defaultResponse>OK Response</con:defaultResponse><con:response name="OK Response" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:AuthentificationResponse>
         <!--Optional:-->
         <return>
            <!--Optional:-->
            <result>TRUE</result>
            <userId>21</userId>
         </return>
      </ser:AuthentificationResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/AuthentificationResponse"/></con:response><con:response name="Login Invalid Response" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:AuthentificationResponse>
         <!--Optional:-->
         <return>
            <!--Optional:-->
            <result>FALSE</result>
            <userId>0</userId>
         </return>
      </ser:AuthentificationResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/AuthentificationResponse"/></con:response><con:dispatchConfig/></con:mockOperation><con:mockOperation name="PaymentInformations" interface="PaymentInformationsServicePortBinding" operation="PaymentInformations"><con:settings/><con:dispatchStyle>SEQUENCE</con:dispatchStyle><con:defaultResponse>Response 1</con:defaultResponse><con:response name="Response 1" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.ws.ingesup.fr/">
   <soapenv:Header/>
   <soapenv:Body>
      <ser:PaymentInformationsResponse>
         <!--Zero or more repetitions:-->
         <return>
            <!--Optional:-->
            <date>?</date>
            <!--Optional:-->
            <description>?</description>
         </return>
      </ser:PaymentInformationsResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://service.ws.ingesup.fr/PaymentInformationsService/PaymentInformationsResponse"/></con:response><con:dispatchConfig/></con:mockOperation><con:properties/></con:mockService><con:mockService port="8080" path="/" host="EVOLUTION.local" name="PaymentInformationsMockService"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockService@require-soap-action">false</con:setting></con:settings><con:properties/></con:mockService><con:properties/><con:wssContainer/><con:sensitiveInformation/></con:soapui-project>